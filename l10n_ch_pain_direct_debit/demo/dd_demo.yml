-
  In order to test xml-dd file generation, I will create a customer with
  a bank account and go through the entire generation process
-
  I set the Initiating Party Identifier on the company. This is required for
  the generation of the XML-DD. The current code was taken from the one given
  as an example at the downloadable example at
  https://www.six-interbank-clearing.com/en/home/standardization/iso-payments/
      customer-bank/implementation-guidelines.html#Swiss-direct-debits.

-
  !record {model: res.company, id: base.main_company, view: False}:
    initiating_party_identifier: 'CH1312300000012345'

-
  I create one bank for XML-DD (as the clearing number is on the bank object)
-
  !record {model: res.bank, id: bank_post, view: False}:
    name: 'Postfinance AG'
    code: 'postfinance'
    bic: 'POFICHBEXXX'
    clearing: '9000'
    street: 'Postfinance'
    zip: '3030'
    city: 'Bern'

-
  I create the partner bank account for XML-DD (account which will be debited)
-
  !record {model: res.partner.bank, id: partner_bank_post_xml_dd, view: False}:
    acc_type: 'postal'
    acc_number: 'CH63 0900 0000 2500 9779 8'
    partner_id: base.res_partner_2
    bank_id: bank_post

-
  Then add a mandate on DD bank account for XML-DD
-
  !record {model: account.banking.mandate, id: post_mandate_xml_dd, view: False}:
    partner_bank_id: partner_bank_post_xml_dd
    signature_date: !eval "'%s-01-01' %(datetime.now().year)"
    state: valid
    type: recurrent
    recurrent_sequence_type: first

-
  We need a company bvr account for the XML-DD (account which will be credited)
-
  !record {model: res.partner.bank, id: company_bank_post_xml_dd, view: False}:
    acc_type: 'postal'
    acc_number: 'CH10 0900 0000 2500 9778 2'
    partner_id: base.main_partner
    bank_id: bank_post

-
    We create a journal for XML-DD
-
  !record {model: account.journal, id: dd_account_journal_xml_dd, view: False}:
    name: Bank XML-DD Journal
    type: bank
    bank_account_id: company_bank_post_xml_dd
-
  ...and link its debit method.
-
  !record {model: account.journal, id: dd_account_journal_xml_dd, view: False}:
    inbound_payment_method_ids:
      - export_sepa_dd

-
  We need a payment mode to create a direct debit order. We create one for
  XML-DD.
-
  !record {model: account.payment.mode, id: dd_pay_mode_xml_dd, view: False}:
    bank_account_link: fixed
    fixed_journal_id: dd_account_journal_xml_dd
    name: 'DD XML'
    active: True
    payment_method_id: export_sepa_dd
    payment_order_ok: True
